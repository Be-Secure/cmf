
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="CMF - Common Metadata Framework">
      
      
        <meta name="author" content="AI Research & Development Lab (Hewlett-Packard Labs)">
      
      
      
        <link rel="prev" href="../../../cmf_server/cmf-server/">
      
      
        <link rel="next" href="../dataslice/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.8">
    
    
      
        <title>CMF - CMF</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.f2e4d321.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cmflibcmfcmf" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="CMF" class="md-header__button md-logo" aria-label="CMF" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CMF
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CMF
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/HewlettPackard/cmf" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    HewlettPackard/cmf
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="CMF" class="md-nav__button md-logo" aria-label="CMF" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    CMF
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/HewlettPackard/cmf" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    HewlettPackard/cmf
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CMF in a nutshell
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cmf_client/step-by-step/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../examples/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Components
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/advantages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advantages
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Client
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Client
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cmf_client/cmf_client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cmf_client/step-by-step/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cmf_client/minio-server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dvc minio backend
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Server
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Server
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cmf_server/cmf-server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Public API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Public API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    CMF
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    CMF
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.create_context" class="md-nav__link">
    <span class="md-ellipsis">
      create_context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.create_execution" class="md-nav__link">
    <span class="md-ellipsis">
      create_execution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.log_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      log_dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.log_model" class="md-nav__link">
    <span class="md-ellipsis">
      log_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.log_execution_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      log_execution_metrics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.log_metric" class="md-nav__link">
    <span class="md-ellipsis">
      log_metric
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.create_dataslice" class="md-nav__link">
    <span class="md-ellipsis">
      create_dataslice
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataslice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DataSlice
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Ontology
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Ontology
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../common-metadata-ontology/readme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ontology
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.create_context" class="md-nav__link">
    <span class="md-ellipsis">
      create_context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.create_execution" class="md-nav__link">
    <span class="md-ellipsis">
      create_execution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.log_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      log_dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.log_model" class="md-nav__link">
    <span class="md-ellipsis">
      log_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.log_execution_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      log_execution_metrics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.log_metric" class="md-nav__link">
    <span class="md-ellipsis">
      log_metric
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cmflib.cmf.Cmf.create_dataslice" class="md-nav__link">
    <span class="md-ellipsis">
      create_dataslice
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="cmflibcmfcmf">cmflib.cmf.Cmf<a class="headerlink" href="#cmflibcmfcmf" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-class">




  <div class="doc doc-contents first">

  
      <p>This class provides methods to log metadata for distributed AI pipelines.
The class instance creates an ML metadata store to store the metadata.
It creates a driver to store nodes and its relationships to neo4j.
The user has to provide the name of the pipeline, that needs to be recorded with CMF.
<div class="highlight"><pre><span></span><code><span class="n">cmflib</span><span class="o">.</span><span class="n">cmf</span><span class="o">.</span><span class="n">Cmf</span><span class="p">(</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;mlmd&quot;</span><span class="p">,</span>
    <span class="n">pipeline_name</span><span class="o">=</span><span class="s2">&quot;test_pipeline&quot;</span><span class="p">,</span>
    <span class="n">custom_properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;owner&quot;</span><span class="p">:</span> <span class="s2">&quot;user_a&quot;</span><span class="p">},</span>
    <span class="n">graph</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</code></pre></div>
Args:
    filename: Path  to the sqlite file to store the metadata
    pipeline_name: Name to uniquely identify the pipeline.
    Note that name is the unique identifier for a pipeline.
    If a pipeline already exist with the same name, the existing pipeline object is reused.
    custom_properties: Additional properties of the pipeline that needs to be stored.
    graph: If set to true, the libray also stores the relationships in the provided graph database.
    The following
    variables should be set: <code>neo4j_uri</code> (graph server URI), <code>neo4j_user</code> (user name) and
    <code>neo4j_password</code> (user password), e.g.:
    <div class="highlight"><pre><span></span><code>cmf init local --path /home/user/local-storage --git-remote-url https://github.com/XXX/exprepo.git --neo4j-user neo4j --neo4j-password neo4j
                      --neo4j-uri bolt://localhost:7687
</code></pre></div></p>

                <details class="quote">
                  <summary>Source code in <code>cmflib/cmf.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mlmd&quot;</span><span class="p">,</span>
    <span class="n">pipeline_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">custom_properties</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">is_server</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">is_server</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">Cmf</span><span class="o">.</span><span class="n">__prechecks</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">custom_properties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">custom_properties</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">ConnectionConfig</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">filename_uri</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">metadata_store</span><span class="o">.</span><span class="n">MetadataStore</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">child_context</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_command</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_artifacts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_label_props</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">branch_name</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">is_server</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">git_checkout_new_branch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">branch_name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span> <span class="o">=</span> <span class="n">get_or_create_parent_context</span><span class="p">(</span>
        <span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span>
        <span class="n">pipeline</span><span class="o">=</span><span class="n">pipeline_name</span><span class="p">,</span>
        <span class="n">custom_properties</span><span class="o">=</span><span class="n">custom_properties</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_server</span><span class="p">:</span>
        <span class="n">Cmf</span><span class="o">.</span><span class="n">__get_neo4j_server_config</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">Cmf</span><span class="o">.</span><span class="n">__load_neo4j_params</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">graph_wrapper</span><span class="o">.</span><span class="n">GraphDriver</span><span class="p">(</span>
            <span class="n">Cmf</span><span class="o">.</span><span class="n">__neo4j_uri</span><span class="p">,</span> <span class="n">Cmf</span><span class="o">.</span><span class="n">__neo4j_user</span><span class="p">,</span> <span class="n">Cmf</span><span class="o">.</span><span class="n">__neo4j_password</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">create_pipeline_node</span><span class="p">(</span>
            <span class="n">pipeline_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">custom_properties</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="cmflib.cmf.Cmf.create_context" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_context</span><span class="p">(</span><span class="n">pipeline_stage</span><span class="p">,</span> <span class="n">custom_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cmflib.cmf.Cmf.create_context" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Create's a  context(stage).
Every call creates a unique pipeline stage.
Example:
    <div class="highlight"><pre><span></span><code><span class="c1">#Create context</span>
<span class="c1"># Import CMF</span>
<span class="kn">from</span> <span class="nn">cmflib.cmf</span> <span class="kn">import</span> <span class="n">Cmf</span>
<span class="kn">from</span> <span class="nn">ml_metadata.proto</span> <span class="kn">import</span> <span class="n">metadata_store_pb2</span> <span class="k">as</span> <span class="n">mlpb</span>
<span class="c1"># Create CMF logger</span>
<span class="n">cmf</span> <span class="o">=</span> <span class="n">Cmf</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;mlmd&quot;</span><span class="p">,</span> <span class="n">pipeline_name</span><span class="o">=</span><span class="s2">&quot;test_pipeline&quot;</span><span class="p">)</span>
<span class="c1"># Create context</span>
<span class="n">context</span><span class="p">:</span> <span class="n">mlmd</span><span class="o">.</span><span class="n">proto</span><span class="o">.</span><span class="n">Context</span> <span class="o">=</span> <span class="n">cmf</span><span class="o">.</span><span class="n">create_context</span><span class="p">(</span>
    <span class="n">pipeline_stage</span><span class="o">=</span><span class="s2">&quot;prepare&quot;</span><span class="p">,</span>
    <span class="n">custom_properties</span> <span class="o">=</span><span class="p">{</span><span class="s2">&quot;user-metadata1&quot;</span><span class="p">:</span> <span class="s2">&quot;metadata_value&quot;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
    Args:
        Pipeline_stage: Name of the Stage.
        custom_properties: Developers can provide key value pairs with additional properties of the execution that
            need to be stored.
    Returns:
        Context object from ML Metadata library associated with the new context for this stage.</p>

          <details class="quote">
            <summary>Source code in <code>cmflib/cmf.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_context</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_stage</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">custom_properties</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">Context</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create&#39;s a  context(stage).</span>
<span class="sd">    Every call creates a unique pipeline stage.</span>
<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        #Create context</span>
<span class="sd">        # Import CMF</span>
<span class="sd">        from cmflib.cmf import Cmf</span>
<span class="sd">        from ml_metadata.proto import metadata_store_pb2 as mlpb</span>
<span class="sd">        # Create CMF logger</span>
<span class="sd">        cmf = Cmf(filename=&quot;mlmd&quot;, pipeline_name=&quot;test_pipeline&quot;)</span>
<span class="sd">        # Create context</span>
<span class="sd">        context: mlmd.proto.Context = cmf.create_context(</span>
<span class="sd">            pipeline_stage=&quot;prepare&quot;,</span>
<span class="sd">            custom_properties ={&quot;user-metadata1&quot;: &quot;metadata_value&quot;}</span>
<span class="sd">        )</span>

<span class="sd">        ```</span>
<span class="sd">        Args:</span>
<span class="sd">            Pipeline_stage: Name of the Stage.</span>
<span class="sd">            custom_properties: Developers can provide key value pairs with additional properties of the execution that</span>
<span class="sd">                need to be stored.</span>
<span class="sd">        Returns:</span>
<span class="sd">            Context object from ML Metadata library associated with the new context for this stage.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">custom_props</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">custom_properties</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">custom_properties</span>
    <span class="n">pipeline_stage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">pipeline_stage</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">get_or_create_run_context</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="n">pipeline_stage</span><span class="p">,</span> <span class="n">custom_props</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">child_context</span> <span class="o">=</span> <span class="n">ctx</span>
    <span class="n">associate_child_to_parent_context</span><span class="p">(</span>
        <span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="n">parent_context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="p">,</span> <span class="n">child_context</span><span class="o">=</span><span class="n">ctx</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">create_stage_node</span><span class="p">(</span>
            <span class="n">pipeline_stage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">custom_props</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">ctx</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="cmflib.cmf.Cmf.create_execution" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_execution</span><span class="p">(</span><span class="n">execution_type</span><span class="p">,</span> <span class="n">custom_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_new_execution</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#cmflib.cmf.Cmf.create_execution" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Create execution.
Every call creates a unique execution. Execution can only be created within a context, so
<a class="autorefs autorefs-internal" href="#cmflib.cmf.Cmf.create_context">create_context</a> must be called first.
Example:
    <div class="highlight"><pre><span></span><code><span class="c1"># Import CMF</span>
<span class="kn">from</span> <span class="nn">cmflib.cmf</span> <span class="kn">import</span> <span class="n">Cmf</span>
<span class="kn">from</span> <span class="nn">ml_metadata.proto</span> <span class="kn">import</span> <span class="n">metadata_store_pb2</span> <span class="k">as</span> <span class="n">mlpb</span>
<span class="c1"># Create CMF logger</span>
<span class="n">cmf</span> <span class="o">=</span> <span class="n">Cmf</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;mlmd&quot;</span><span class="p">,</span> <span class="n">pipeline_name</span><span class="o">=</span><span class="s2">&quot;test_pipeline&quot;</span><span class="p">)</span>
<span class="c1"># Create or reuse context for this stage</span>
<span class="n">context</span><span class="p">:</span> <span class="n">mlmd</span><span class="o">.</span><span class="n">proto</span><span class="o">.</span><span class="n">Context</span> <span class="o">=</span> <span class="n">cmf</span><span class="o">.</span><span class="n">create_context</span><span class="p">(</span>
    <span class="n">pipeline_stage</span><span class="o">=</span><span class="s2">&quot;prepare&quot;</span><span class="p">,</span>
    <span class="n">custom_properties</span> <span class="o">=</span><span class="p">{</span><span class="s2">&quot;user-metadata1&quot;</span><span class="p">:</span> <span class="s2">&quot;metadata_value&quot;</span><span class="p">}</span>
<span class="p">)</span>
<span class="c1"># Create a new execution for this stage run</span>
<span class="n">execution</span><span class="p">:</span> <span class="n">mlmd</span><span class="o">.</span><span class="n">proto</span><span class="o">.</span><span class="n">Execution</span> <span class="o">=</span> <span class="n">cmf</span><span class="o">.</span><span class="n">create_execution</span><span class="p">(</span>
    <span class="n">execution_type</span><span class="o">=</span><span class="s2">&quot;Prepare&quot;</span><span class="p">,</span>
    <span class="n">custom_properties</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;split&quot;</span><span class="p">:</span> <span class="n">split</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="n">seed</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
Args:
    execution_type: Type of the execution.(when create_new_execution is False, this is the name of execution)
    custom_properties: Developers can provide key value pairs with additional properties of the execution that
        need to be stored.</p>
<pre><code>cmd: command used to run this execution.

create_new_execution:bool = True, This can be used by advanced users to re-use executions
    This is applicable, when working with framework code like mmdet, pytorch lightning etc, where the
    custom call-backs are used to log metrics.
    if create_new_execution is True(Default), execution_type parameter will be used as the name of the execution type.
    if create_new_execution is False, if existing execution exist with the same name as execution_type.
    it will be reused.
    Only executions created with  create_new_execution as False will have "name" as a property.
</code></pre>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="ml_metadata.proto.metadata_store_pb2.Execution">Execution</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Execution object from ML Metadata library associated with the new execution for this stage.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>cmflib/cmf.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_execution</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">execution_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">custom_properties</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cmd</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">create_new_execution</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">Execution</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create execution.</span>
<span class="sd">    Every call creates a unique execution. Execution can only be created within a context, so</span>
<span class="sd">    [create_context][cmflib.cmf.Cmf.create_context] must be called first.</span>
<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Import CMF</span>
<span class="sd">        from cmflib.cmf import Cmf</span>
<span class="sd">        from ml_metadata.proto import metadata_store_pb2 as mlpb</span>
<span class="sd">        # Create CMF logger</span>
<span class="sd">        cmf = Cmf(filename=&quot;mlmd&quot;, pipeline_name=&quot;test_pipeline&quot;)</span>
<span class="sd">        # Create or reuse context for this stage</span>
<span class="sd">        context: mlmd.proto.Context = cmf.create_context(</span>
<span class="sd">            pipeline_stage=&quot;prepare&quot;,</span>
<span class="sd">            custom_properties ={&quot;user-metadata1&quot;: &quot;metadata_value&quot;}</span>
<span class="sd">        )</span>
<span class="sd">        # Create a new execution for this stage run</span>
<span class="sd">        execution: mlmd.proto.Execution = cmf.create_execution(</span>
<span class="sd">            execution_type=&quot;Prepare&quot;,</span>
<span class="sd">            custom_properties = {&quot;split&quot;: split, &quot;seed&quot;: seed}</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    Args:</span>
<span class="sd">        execution_type: Type of the execution.(when create_new_execution is False, this is the name of execution)</span>
<span class="sd">        custom_properties: Developers can provide key value pairs with additional properties of the execution that</span>
<span class="sd">            need to be stored.</span>

<span class="sd">        cmd: command used to run this execution.</span>

<span class="sd">        create_new_execution:bool = True, This can be used by advanced users to re-use executions</span>
<span class="sd">            This is applicable, when working with framework code like mmdet, pytorch lightning etc, where the</span>
<span class="sd">            custom call-backs are used to log metrics.</span>
<span class="sd">            if create_new_execution is True(Default), execution_type parameter will be used as the name of the execution type.</span>
<span class="sd">            if create_new_execution is False, if existing execution exist with the same name as execution_type.</span>
<span class="sd">            it will be reused.</span>
<span class="sd">            Only executions created with  create_new_execution as False will have &quot;name&quot; as a property.</span>


<span class="sd">    Returns:</span>
<span class="sd">        Execution object from ML Metadata library associated with the new execution for this stage.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initializing the execution related fields</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">input_artifacts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_label_props</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">custom_props</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">custom_properties</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">custom_properties</span>
    <span class="n">git_repo</span> <span class="o">=</span> <span class="n">git_get_repo</span><span class="p">()</span>
    <span class="n">git_start_commit</span> <span class="o">=</span> <span class="n">git_get_commit</span><span class="p">()</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="k">if</span> <span class="n">cmd</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">cmd</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution</span> <span class="o">=</span> <span class="n">create_new_execution_in_existing_run_context</span><span class="p">(</span>
        <span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span>
        <span class="c1"># Type field when re-using executions</span>
        <span class="n">execution_type_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">child_context</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">execution_name</span><span class="o">=</span><span class="n">execution_type</span><span class="p">,</span> 
        <span class="c1">#Name field if we are re-using executions</span>
        <span class="c1">#Type field , if creating new executions always </span>
        <span class="n">context_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">child_context</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">execution</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span>
        <span class="n">pipeline_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">pipeline_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">git_repo</span><span class="o">=</span><span class="n">git_repo</span><span class="p">,</span>
        <span class="n">git_start_commit</span><span class="o">=</span><span class="n">git_start_commit</span><span class="p">,</span>
        <span class="n">custom_properties</span><span class="o">=</span><span class="n">custom_props</span><span class="p">,</span>
        <span class="n">create_new_execution</span><span class="o">=</span><span class="n">create_new_execution</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">uuids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;Execution_uuid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">string_value</span>
    <span class="k">if</span> <span class="n">uuids</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;Execution_uuid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">string_value</span> <span class="o">=</span> <span class="n">uuids</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">&quot;Execution_uuid&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">string_value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">())</span>            
    <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">put_executions</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="n">execution_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_command</span> <span class="o">=</span> <span class="n">cmd</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">custom_props</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_label_props</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_label_props</span><span class="p">[</span><span class="s2">&quot;Execution_Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">execution_type</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_label_props</span><span class="p">[</span><span class="s2">&quot;execution_command&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">create_execution_node</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">child_context</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">custom_props</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="cmflib.cmf.Cmf.log_dataset" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">log_dataset</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">custom_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">external</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#cmflib.cmf.Cmf.log_dataset" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Logs a dataset as artifact.
This call adds the dataset to dvc. The dvc metadata file created (.dvc) will be added to git and committed. The
version of the  dataset is automatically obtained from the versioning software(DVC) and tracked as a metadata.
Example:
    <div class="highlight"><pre><span></span><code><span class="n">artifact</span><span class="p">:</span> <span class="n">mlmd</span><span class="o">.</span><span class="n">proto</span><span class="o">.</span><span class="n">Artifact</span> <span class="o">=</span> <span class="n">cmf</span><span class="o">.</span><span class="n">log_dataset</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;/repo/data.xml&quot;</span><span class="p">,</span>
    <span class="n">event</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
    <span class="n">custom_properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span><span class="s2">&quot;kaggle&quot;</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
Args:
     url: The path to the dataset.
     event: Takes arguments <code>INPUT</code> OR <code>OUTPUT</code>.
     custom_properties: Dataset properties (key/value pairs).
Returns:
    Artifact object from ML Metadata library associated with the new dataset artifact.</p>

          <details class="quote">
            <summary>Source code in <code>cmflib/cmf.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log_dataset</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">custom_properties</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">external</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">Artifact</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Logs a dataset as artifact.</span>
<span class="sd">    This call adds the dataset to dvc. The dvc metadata file created (.dvc) will be added to git and committed. The</span>
<span class="sd">    version of the  dataset is automatically obtained from the versioning software(DVC) and tracked as a metadata.</span>
<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        artifact: mlmd.proto.Artifact = cmf.log_dataset(</span>
<span class="sd">            url=&quot;/repo/data.xml&quot;,</span>
<span class="sd">            event=&quot;input&quot;,</span>
<span class="sd">            custom_properties={&quot;source&quot;:&quot;kaggle&quot;}</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    Args:</span>
<span class="sd">         url: The path to the dataset.</span>
<span class="sd">         event: Takes arguments `INPUT` OR `OUTPUT`.</span>
<span class="sd">         custom_properties: Dataset properties (key/value pairs).</span>
<span class="sd">    Returns:</span>
<span class="sd">        Artifact object from ML Metadata library associated with the new dataset artifact.</span>
<span class="sd">    &quot;&quot;&quot;</span>
            <span class="c1">### To Do : Technical Debt. </span>
    <span class="c1"># If the dataset already exist , then we just link the existing dataset to the execution</span>
    <span class="c1"># We do not update the dataset properties . </span>
    <span class="c1"># We need to append the new properties to the existing dataset properties</span>

    <span class="n">custom_props</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">custom_properties</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">custom_properties</span>
    <span class="n">git_repo</span> <span class="o">=</span> <span class="n">git_get_repo</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">event_type</span> <span class="o">=</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">OUTPUT</span>
    <span class="n">existing_artifact</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
        <span class="n">event_type</span> <span class="o">=</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">INPUT</span>

    <span class="n">commit_output</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="n">c_hash</span> <span class="o">=</span> <span class="n">dvc_get_hash</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">dataset_commit</span> <span class="o">=</span> <span class="n">c_hash</span>
    <span class="n">dvc_url</span> <span class="o">=</span> <span class="n">dvc_get_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">dvc_url_with_pipeline</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">dvc_url</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">url</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">c_hash</span>
    <span class="k">if</span> <span class="n">c_hash</span> <span class="ow">and</span> <span class="n">c_hash</span><span class="o">.</span><span class="n">strip</span><span class="p">:</span>
        <span class="n">existing_artifact</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_artifacts_by_uri</span><span class="p">(</span><span class="n">c_hash</span><span class="p">))</span>

    <span class="c1"># To Do - What happens when uri is the same but names are different</span>
    <span class="k">if</span> <span class="n">existing_artifact</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_artifact</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">existing_artifact</span> <span class="o">=</span> <span class="n">existing_artifact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Quick fix- Updating only the name</span>
        <span class="k">if</span> <span class="n">custom_properties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_existing_artifact</span><span class="p">(</span>
                <span class="n">existing_artifact</span><span class="p">,</span> <span class="n">custom_properties</span><span class="p">)</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">c_hash</span>
        <span class="c1"># update url for existing artifact</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_dataset_url</span><span class="p">(</span><span class="n">existing_artifact</span><span class="p">,</span> <span class="n">dvc_url_with_pipeline</span><span class="p">)</span>
        <span class="n">artifact</span> <span class="o">=</span> <span class="n">link_execution_to_artifact</span><span class="p">(</span>
            <span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span>
            <span class="n">execution_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span>
            <span class="n">input_name</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># if((existing_artifact and len(existing_artifact )!= 0) and c_hash != &quot;&quot;):</span>
        <span class="c1">#   url = url + &quot;:&quot; + str(self.execution.id)</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">c_hash</span> <span class="k">if</span> <span class="n">c_hash</span> <span class="ow">and</span> <span class="n">c_hash</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">())</span>
        <span class="n">artifact</span> <span class="o">=</span> <span class="n">create_new_artifact_event_and_attribution</span><span class="p">(</span>
            <span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span>
            <span class="n">execution_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">context_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">child_context</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">type_name</span><span class="o">=</span><span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;git_repo&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">git_repo</span><span class="p">),</span>
                <span class="c1"># passing c_hash value to commit</span>
                <span class="s2">&quot;Commit&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">dataset_commit</span><span class="p">),</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">dvc_url_with_pipeline</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="n">artifact_type_properties</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;git_repo&quot;</span><span class="p">:</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
                <span class="s2">&quot;Commit&quot;</span><span class="p">:</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">custom_properties</span><span class="o">=</span><span class="n">custom_props</span><span class="p">,</span>
            <span class="n">milliseconds_since_epoch</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="n">custom_props</span><span class="p">[</span><span class="s2">&quot;git_repo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">git_repo</span>
    <span class="n">custom_props</span><span class="p">[</span><span class="s2">&quot;Commit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_commit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_label_props</span><span class="p">[</span><span class="s2">&quot;git_repo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">git_repo</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_label_props</span><span class="p">[</span><span class="s2">&quot;Commit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_commit</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">create_dataset_node</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">uri</span><span class="p">,</span>
            <span class="n">event</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="p">,</span>
            <span class="n">custom_props</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_artifacts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;Path&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                    <span class="s2">&quot;URI&quot;</span><span class="p">:</span> <span class="n">uri</span><span class="p">,</span>
                    <span class="s2">&quot;Event&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                    <span class="s2">&quot;Execution_Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_name</span><span class="p">,</span>
                    <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Execution_Command&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_command</span><span class="p">,</span>
                    <span class="s2">&quot;Pipeline_Id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="s2">&quot;Pipeline_Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">create_execution_links</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">child_artifact</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;Path&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                <span class="s2">&quot;URI&quot;</span><span class="p">:</span> <span class="n">uri</span><span class="p">,</span>
                <span class="s2">&quot;Event&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                <span class="s2">&quot;Execution_Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_name</span><span class="p">,</span>
                <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Execution_Command&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_command</span><span class="p">,</span>
                <span class="s2">&quot;Pipeline_Id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s2">&quot;Pipeline_Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">create_artifact_relationships</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input_artifacts</span><span class="p">,</span> <span class="n">child_artifact</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_label_props</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">artifact</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="cmflib.cmf.Cmf.log_model" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">log_model</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">model_framework</span><span class="o">=</span><span class="s1">&#39;Default&#39;</span><span class="p">,</span> <span class="n">model_type</span><span class="o">=</span><span class="s1">&#39;Default&#39;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;Default&#39;</span><span class="p">,</span> <span class="n">custom_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cmflib.cmf.Cmf.log_model" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Logs a model.
The model is added to dvc and the metadata file (.dvc) gets committed to git.
Example:
    <div class="highlight"><pre><span></span><code><span class="n">artifact</span><span class="p">:</span> <span class="n">mlmd</span><span class="o">.</span><span class="n">proto</span><span class="o">.</span><span class="n">Artifact</span><span class="o">=</span> <span class="n">cmf</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">&quot;path/to/model.pkl&quot;</span><span class="p">,</span>
    <span class="n">event</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
    <span class="n">model_framework</span><span class="o">=</span><span class="s2">&quot;SKlearn&quot;</span><span class="p">,</span>
    <span class="n">model_type</span><span class="o">=</span><span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">,</span>
    <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;RandomForestClassifier:default&quot;</span>
<span class="p">)</span>
</code></pre></div>
Args:
    path: Path to the model file.
    event: Takes arguments <code>INPUT</code> OR <code>OUTPUT</code>.
    model_framework: Framework used to create the model.
    model_type: Type of model algorithm used.
    model_name: Name of the algorithm used.
    custom_properties: The model properties.
Returns:
    Artifact object from ML Metadata library associated with the new model artifact.</p>

          <details class="quote">
            <summary>Source code in <code>cmflib/cmf.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log_model</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">model_framework</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Default&quot;</span><span class="p">,</span>
    <span class="n">model_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Default&quot;</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Default&quot;</span><span class="p">,</span>
    <span class="n">custom_properties</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">Artifact</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Logs a model.</span>
<span class="sd">    The model is added to dvc and the metadata file (.dvc) gets committed to git.</span>
<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        artifact: mlmd.proto.Artifact= cmf.log_model(</span>
<span class="sd">            path=&quot;path/to/model.pkl&quot;,</span>
<span class="sd">            event=&quot;output&quot;,</span>
<span class="sd">            model_framework=&quot;SKlearn&quot;,</span>
<span class="sd">            model_type=&quot;RandomForestClassifier&quot;,</span>
<span class="sd">            model_name=&quot;RandomForestClassifier:default&quot;</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    Args:</span>
<span class="sd">        path: Path to the model file.</span>
<span class="sd">        event: Takes arguments `INPUT` OR `OUTPUT`.</span>
<span class="sd">        model_framework: Framework used to create the model.</span>
<span class="sd">        model_type: Type of model algorithm used.</span>
<span class="sd">        model_name: Name of the algorithm used.</span>
<span class="sd">        custom_properties: The model properties.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Artifact object from ML Metadata library associated with the new model artifact.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># To Do : Technical Debt. </span>
    <span class="c1"># If the model already exist , then we just link the existing model to the execution</span>
    <span class="c1"># We do not update the model properties . </span>
    <span class="c1"># We need to append the new properties to the existing model properties</span>

    <span class="k">if</span> <span class="n">custom_properties</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">custom_properties</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">custom_props</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">custom_properties</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">custom_properties</span>
    <span class="c1"># name = re.split(&#39;/&#39;, path)[-1]</span>
    <span class="n">event_type</span> <span class="o">=</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">OUTPUT</span>
    <span class="n">existing_artifact</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
        <span class="n">event_type</span> <span class="o">=</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">INPUT</span>

    <span class="n">commit_output</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="n">c_hash</span> <span class="o">=</span> <span class="n">dvc_get_hash</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">model_commit</span> <span class="o">=</span> <span class="n">c_hash</span>

    <span class="c1"># If connecting to an existing artifact - The name of the artifact is</span>
    <span class="c1"># used as path/steps/key</span>
    <span class="n">model_uri</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">c_hash</span>
    <span class="n">dvc_url</span> <span class="o">=</span> <span class="n">dvc_get_url</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">dvc_url</span>
    <span class="n">url_with_pipeline</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">c_hash</span> <span class="ow">and</span> <span class="n">c_hash</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">c_hash</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">existing_artifact</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">get_artifacts_by_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Model commit failed, Model uri empty&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">existing_artifact</span>
        <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">existing_artifact</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="p">):</span>
        <span class="c1"># update url for existing artifact</span>
        <span class="n">existing_artifact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_model_url</span><span class="p">(</span>
            <span class="n">existing_artifact</span><span class="p">,</span> <span class="n">url_with_pipeline</span>
        <span class="p">)</span>
        <span class="n">artifact</span> <span class="o">=</span> <span class="n">link_execution_to_artifact</span><span class="p">(</span>
            <span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span>
            <span class="n">execution_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">uri</span><span class="o">=</span><span class="n">c_hash</span><span class="p">,</span>
            <span class="n">input_name</span><span class="o">=</span><span class="n">model_uri</span><span class="p">,</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">model_uri</span> <span class="o">=</span> <span class="n">artifact</span><span class="o">.</span><span class="n">name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="n">c_hash</span> <span class="k">if</span> <span class="n">c_hash</span> <span class="ow">and</span> <span class="n">c_hash</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">())</span>
        <span class="n">model_uri</span> <span class="o">=</span> <span class="n">model_uri</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">artifact</span> <span class="o">=</span> <span class="n">create_new_artifact_event_and_attribution</span><span class="p">(</span>
            <span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span>
            <span class="n">execution_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">context_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">child_context</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">model_uri</span><span class="p">,</span>
            <span class="n">type_name</span><span class="o">=</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span>
            <span class="n">event_type</span><span class="o">=</span><span class="n">event_type</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;model_framework&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">model_framework</span><span class="p">),</span>
                <span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">model_type</span><span class="p">),</span>
                <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">model_name</span><span class="p">),</span>
                <span class="c1"># passing c_hash value to commit</span>
                <span class="s2">&quot;Commit&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">model_commit</span><span class="p">),</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">url_with_pipeline</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="n">artifact_type_properties</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;model_framework&quot;</span><span class="p">:</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
                <span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
                <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
                <span class="s2">&quot;Commit&quot;</span><span class="p">:</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">custom_properties</span><span class="o">=</span><span class="n">custom_props</span><span class="p">,</span>
            <span class="n">milliseconds_since_epoch</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="c1"># custom_properties[&quot;Commit&quot;] = model_commit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_label_props</span><span class="p">[</span><span class="s2">&quot;Commit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_commit</span>
    <span class="c1">#To DO model nodes should be similar to dataset nodes when we create neo4j</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">create_model_node</span><span class="p">(</span>
            <span class="n">model_uri</span><span class="p">,</span>
            <span class="n">uri</span><span class="p">,</span>
            <span class="n">event</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="p">,</span>
            <span class="n">custom_props</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;input&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_artifacts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">model_uri</span><span class="p">,</span>
                    <span class="s2">&quot;URI&quot;</span><span class="p">:</span> <span class="n">uri</span><span class="p">,</span>
                    <span class="s2">&quot;Event&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                    <span class="s2">&quot;Execution_Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_name</span><span class="p">,</span>
                    <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;Model&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Execution_Command&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_command</span><span class="p">,</span>
                    <span class="s2">&quot;Pipeline_Id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="s2">&quot;Pipeline_Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">create_execution_links</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">model_uri</span><span class="p">,</span> <span class="s2">&quot;Model&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">child_artifact</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">model_uri</span><span class="p">,</span>
                <span class="s2">&quot;URI&quot;</span><span class="p">:</span> <span class="n">uri</span><span class="p">,</span>
                <span class="s2">&quot;Event&quot;</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                <span class="s2">&quot;Execution_Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_name</span><span class="p">,</span>
                <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;Model&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Execution_Command&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_command</span><span class="p">,</span>
                <span class="s2">&quot;Pipeline_Id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s2">&quot;Pipeline_Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">create_artifact_relationships</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input_artifacts</span><span class="p">,</span> <span class="n">child_artifact</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_label_props</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">artifact</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="cmflib.cmf.Cmf.log_execution_metrics" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">log_execution_metrics</span><span class="p">(</span><span class="n">metrics_name</span><span class="p">,</span> <span class="n">custom_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cmflib.cmf.Cmf.log_execution_metrics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Log the metadata associated with the execution (coarse-grained tracking).
It is stored as a metrics artifact. This does not have a backing physical file, unlike other artifacts that we
have.
Example:
    <div class="highlight"><pre><span></span><code><span class="n">exec_metrics</span><span class="p">:</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">Artifact</span> <span class="o">=</span> <span class="n">cmf</span><span class="o">.</span><span class="n">log_execution_metrics</span><span class="p">(</span>
    <span class="n">metrics_name</span><span class="o">=</span><span class="s2">&quot;Training_Metrics&quot;</span><span class="p">,</span>
    <span class="p">{</span><span class="s2">&quot;auc&quot;</span><span class="p">:</span> <span class="n">auc</span><span class="p">,</span> <span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="n">loss</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
Args:
    metrics_name: Name to identify the metrics.
    custom_properties: Dictionary with metric values.
Returns:
      Artifact object from ML Metadata library associated with the new coarse-grained metrics artifact.</p>

          <details class="quote">
            <summary>Source code in <code>cmflib/cmf.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log_execution_metrics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">metrics_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">custom_properties</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">Artifact</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log the metadata associated with the execution (coarse-grained tracking).</span>
<span class="sd">    It is stored as a metrics artifact. This does not have a backing physical file, unlike other artifacts that we</span>
<span class="sd">    have.</span>
<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        exec_metrics: mlpb.Artifact = cmf.log_execution_metrics(</span>
<span class="sd">            metrics_name=&quot;Training_Metrics&quot;,</span>
<span class="sd">            {&quot;auc&quot;: auc, &quot;loss&quot;: loss}</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">    Args:</span>
<span class="sd">        metrics_name: Name to identify the metrics.</span>
<span class="sd">        custom_properties: Dictionary with metric values.</span>
<span class="sd">    Returns:</span>
<span class="sd">          Artifact object from ML Metadata library associated with the new coarse-grained metrics artifact.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">custom_props</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">custom_properties</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">custom_properties</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">())</span>
    <span class="n">metrics_name</span> <span class="o">=</span> <span class="n">metrics_name</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">uri</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">create_new_artifact_event_and_attribution</span><span class="p">(</span>
        <span class="n">store</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span>
        <span class="n">execution_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">context_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">child_context</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">metrics_name</span><span class="p">,</span>
        <span class="n">type_name</span><span class="o">=</span><span class="s2">&quot;Metrics&quot;</span><span class="p">,</span>
        <span class="n">event_type</span><span class="o">=</span><span class="n">mlpb</span><span class="o">.</span><span class="n">Event</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">,</span>
        <span class="n">properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metrics_name&quot;</span><span class="p">:</span> <span class="n">metrics_name</span><span class="p">},</span>
        <span class="n">artifact_type_properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metrics_name&quot;</span><span class="p">:</span> <span class="n">mlpb</span><span class="o">.</span><span class="n">STRING</span><span class="p">},</span>
        <span class="n">custom_properties</span><span class="o">=</span><span class="n">custom_props</span><span class="p">,</span>
        <span class="n">milliseconds_since_epoch</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">:</span>
        <span class="c1"># To do create execution_links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">create_metrics_node</span><span class="p">(</span>
            <span class="n">metrics_name</span><span class="p">,</span>
            <span class="n">uri</span><span class="p">,</span>
            <span class="s2">&quot;output&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="p">,</span>
            <span class="n">custom_props</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">child_artifact</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">metrics_name</span><span class="p">,</span>
            <span class="s2">&quot;URI&quot;</span><span class="p">:</span> <span class="n">uri</span><span class="p">,</span>
            <span class="s2">&quot;Event&quot;</span><span class="p">:</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Execution_Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_name</span><span class="p">,</span>
            <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;Metrics&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Execution_Command&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_command</span><span class="p">,</span>
            <span class="s2">&quot;Pipeline_Id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">&quot;Pipeline_Name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_context</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">create_artifact_relationships</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_artifacts</span><span class="p">,</span> <span class="n">child_artifact</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_label_props</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">metrics</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="cmflib.cmf.Cmf.log_metric" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">log_metric</span><span class="p">(</span><span class="n">metrics_name</span><span class="p">,</span> <span class="n">custom_properties</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#cmflib.cmf.Cmf.log_metric" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Stores the fine-grained (per step or per epoch) metrics to memory.
The metrics provided are stored in a parquet file. The <code>commit_metrics</code> call add the parquet file in the version
control framework. The metrics written in the parquet file can be retrieved using the <code>read_metrics</code> call.
Example:
    <div class="highlight"><pre><span></span><code><span class="c1"># Can be called at every epoch or every step in the training. This is logged to a parquet file and committed</span>
<span class="c1"># at the commit stage.</span>
<span class="c1"># Inside training loop</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
     <span class="n">cmf</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;training_metrics&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;train_loss&quot;</span><span class="p">:</span> <span class="n">train_loss</span><span class="p">})</span>
<span class="n">cmf</span><span class="o">.</span><span class="n">commit_metrics</span><span class="p">(</span><span class="s2">&quot;training_metrics&quot;</span><span class="p">)</span>
</code></pre></div>
Args:
    metrics_name: Name to identify the metrics.
    custom_properties: Dictionary with metrics.</p>

          <details class="quote">
            <summary>Source code in <code>cmflib/cmf.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">log_metric</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">metrics_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">custom_properties</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stores the fine-grained (per step or per epoch) metrics to memory.</span>
<span class="sd">    The metrics provided are stored in a parquet file. The `commit_metrics` call add the parquet file in the version</span>
<span class="sd">    control framework. The metrics written in the parquet file can be retrieved using the `read_metrics` call.</span>
<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # Can be called at every epoch or every step in the training. This is logged to a parquet file and committed</span>
<span class="sd">        # at the commit stage.</span>
<span class="sd">        # Inside training loop</span>
<span class="sd">        while True:</span>
<span class="sd">             cmf.log_metric(&quot;training_metrics&quot;, {&quot;train_loss&quot;: train_loss})</span>
<span class="sd">        cmf.commit_metrics(&quot;training_metrics&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    Args:</span>
<span class="sd">        metrics_name: Name to identify the metrics.</span>
<span class="sd">        custom_properties: Dictionary with metrics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">metrics_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">metrics_name</span><span class="p">])</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">metrics_name</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">custom_properties</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">metrics_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">metrics_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">custom_properties</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="cmflib.cmf.Cmf.create_dataslice" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_dataslice</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#cmflib.cmf.Cmf.create_dataslice" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Creates a dataslice object.
Once created, users can add data instances to this data slice with <a class="autorefs autorefs-internal" href="../dataslice/#cmflib.cmf.Cmf.DataSlice.add_data">add_data</a>
method. Users are also responsible for committing data slices by calling the
<a class="autorefs autorefs-internal" href="../dataslice/#cmflib.cmf.Cmf.DataSlice.commit">commit</a> method.
Example:
    <div class="highlight"><pre><span></span><code><span class="n">dataslice</span> <span class="o">=</span> <span class="n">cmf</span><span class="o">.</span><span class="n">create_dataslice</span><span class="p">(</span><span class="s2">&quot;slice-a&quot;</span><span class="p">)</span>
</code></pre></div>
Args:
    name: Name to identify the dataslice.</p>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="cmflib.cmf.Cmf.DataSlice">DataSlice</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Instance of a newly created [DataSlice][cmflib.cmf.Cmf.DataSlice].</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>cmflib/cmf.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_dataslice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Cmf.DataSlice&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a dataslice object.</span>
<span class="sd">    Once created, users can add data instances to this data slice with [add_data][cmflib.cmf.Cmf.DataSlice.add_data]</span>
<span class="sd">    method. Users are also responsible for committing data slices by calling the</span>
<span class="sd">    [commit][cmflib.cmf.Cmf.DataSlice.commit] method.</span>
<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        dataslice = cmf.create_dataslice(&quot;slice-a&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    Args:</span>
<span class="sd">        name: Name to identify the dataslice.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Instance of a newly created [DataSlice][cmflib.cmf.Cmf.DataSlice].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Cmf</span><span class="o">.</span><span class="n">DataSlice</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/HewlettPackard/cmf" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://commonmetadata.slack.com/" target="_blank" rel="noopener" title="commonmetadata.slack.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>